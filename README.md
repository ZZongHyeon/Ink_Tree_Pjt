# Ink_Tree_Pjt

  <img src="https://img.shields.io/badge/java-007396?style=for-the-badge&logo=java&logoColor=white"> 
  <img src="https://img.shields.io/badge/oracle-F80000?style=for-the-badge&logo=oracle&logoColor=white"> 
  <img src="https://img.shields.io/badge/spring-6DB33F?style=for-the-badge&logo=spring&logoColor=white"> 

# ğŸ“¦ ê°œë°œ í™˜ê²½ êµ¬ì¡° ìš”ì•½

| êµ¬ë¶„ | ë‚´ìš©
|-----|-----
| **ê°œë°œ ì–¸ì–´** | Java (JDK 8 ì´ìƒ), JavaScript
| **í”„ë ˆì„ì›Œí¬** | Spring Boot + MyBatis
| **DB** | Oracle 11g ì´ìƒ
| **ë¹Œë“œ ë„êµ¬** | Gradle
| **ë‚´ì¥ WAS** | Spring Boot ë‚´ì¥ Tomcat
| **í˜•ìƒê´€ë¦¬** | Git / GitHub
| **í˜‘ì—… ë„êµ¬** | Jira, Notion

# ê¸°ìˆ  ìŠ¤íƒ (Tech Stack)

### ğŸŒ í”„ë¡ íŠ¸ì—”ë“œ (Frontend)

| ê¸°ìˆ  | ì„¤ëª…
|-----|-----
| JSP | ì„œë²„ ì¸¡ì—ì„œ HTMLì„ ìƒì„±í•˜ëŠ” ë Œë”ë§ ê¸°ìˆ <br>ë™ì ì¸ ì›¹ í˜ì´ì§€ êµ¬í˜„ì— ì‚¬ìš©
| js/jQuery | í´ë¼ì´ì–¸íŠ¸ ì¸¡ì— í•„ìš”í•œ ë™ì‘ì²˜ë¦¬, ë™ì  ì½˜í…ì¸  ë¡œë”©
| MyBatis | SQL Mapper í”„ë ˆì„ì›Œí¬ë¡œ í”„ë¡ íŠ¸ì™€ DBê°„ì˜ íš¨ìœ¨ì ì¸ ë°ì´í„° ë§¤í•‘ í™œìš©


### âš™ï¸ ë°±ì—”ë“œ (Backend)

| ê¸°ìˆ  | ì„¤ëª…
|-----|-----
| Spring Framework | ì»¨íŠ¸ë¡¤ëŸ¬, ì„œë¹„ìŠ¤ ê³„ì¸µì˜ êµ¬í˜„ì„ ìœ„í•´ ì‚¬ìš©<br>í‘œì¤€ MVC íŒ¨í„´ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¡°í™”
| MyBatis | SQLê³¼ ì„œë²„ ê°ì²´ê°„ ë§¤í•‘ë‹´ë‹¹ ë„êµ¬ì, ì‹œí€€ìŠ¤ì™€ ì—°ê³„ê°€ ìš©ë¦„
| Oracle | ëŒ€ê·œëª¨ ë°ì´í„° ê´€ë¦¬ë¥¼ ìœ„í•œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©


### ğŸ› ï¸ ê°œë°œ ë„êµ¬ (Development Tools)

| ë„êµ¬ | ì‚¬ìš© ëª©ì 
|-----|-----
| Visual Studio Code | JS, CSS, í”„ë¡ íŠ¸ ë“± ì½”ë“œ ì‘ì„±ìš© ì—ë””í„°
| Eclipse | Java ë°±ì—”ë“œ ë° Spring ê¸°ë°˜ í”„ë¡œì íŠ¸ êµ¬í˜„
| Jira | ì´ìŠˆ ê´€ë¦¬ ë° êµ¬ì²´ì ì¸ ì¼ì • ê³„íš ìˆ˜ë¦½ì„ ìœ„í•œ í˜‘ì—… ë„êµ¬
| GitHub | ì½”ë“œ ë²„ì „ ê´€ë¦¬ ë° íŒ€ í˜‘ì—…
| Apache Tomcat | ì›¹ì•± ì„œë²„ êµ¬ë™, í…ŒìŠ¤íŠ¸


# ğŸ‘¥ ì—…ë¬´ ë¶„ì¥ (Team Roles)

### ğŸ‘¨â€ğŸ’» ì •ì¢…í˜„ (FullStack)

| ë‹´ë‹¹ ì—…ë¬´ | ì„¸ë¶€ ë‚´ìš©
|-----|-----
| ğŸ—ï¸ ì „ì²´ êµ¬ì¡° ì„¤ê³„ | ì „ì²´ form ì‘ì„±
| ğŸ” íšŒì› ê´€ë¦¬ | íšŒì›ê°€ì… & ë¡œê·¸ì¸
| ğŸ“‹ ê²Œì‹œíŒ | ê²Œì‹œíŒ CRUD êµ¬í˜„
| ğŸ’¬ ì†Œí†µ ê¸°ëŠ¥ | ëŒ“ê¸€ & ëŒ€ëŒ“ê¸€ & ì¶”ì²œ
| ğŸ“š ë„ì„œ ê´€ë¦¬ | ë„ì„œ ë“±ë¡ & ìƒì„¸ì •ë³´ & ê²€ìƒ‰ & ëŒ€ì¶œì¤‘ì¸ ë„ì„œ


### ğŸ¨ ê¹€í˜•ì„­ (Frontend)

| ë‹´ë‹¹ ì—…ë¬´ | ì„¸ë¶€ ë‚´ìš©
|-----|-----
| ğŸ“š ë„ì„œ ê¸°ëŠ¥ | ë„ì„œ ì¶”ì²œ & ìˆ˜ì • & ë“±ë¡
| ğŸ‘¤ ì‚¬ìš©ì ì •ë³´ | ê°œì¸ ì •ë³´ ìˆ˜ì •


### âš™ï¸ ì´ë³‘í›ˆ (Backend)

| ë‹´ë‹¹ ì—…ë¬´ | ì„¸ë¶€ ë‚´ìš©
|-----|-----
| ğŸ“š ë„ì„œ ê´€ë¦¬ | ë„ì„œ ìˆ˜ì •
| ğŸ‘¤ ì‚¬ìš©ì ì •ë³´ | ê°œì¸ ì •ë³´ ìˆ˜ì •
| ğŸ“ ê²Œì‹œê¸€ ê´€ë¦¬ | ê²Œì‹œê¸€ ì‘ì„± & ìˆ˜ì • & ì‚­ì œ


### ğŸ”§ ì •ì¬ìœ¤ (Backend)

| ë‹´ë‹¹ ì—…ë¬´ | ì„¸ë¶€ ë‚´ìš©
|-----|-----
| ğŸ“¢ ê³µì§€ì‚¬í•­ | ê³µì§€ì‚¬í•­ ì‘ì„± & ìˆ˜ì • & ì‚­ì œ
| ğŸ“š ë„ì„œ ëŒ€ì¶œ ì‹œìŠ¤í…œ | ë„ì„œ ëŒ€ì¶œ & ë°˜ë‚© & ì‚­ì œ & ë°˜ë‚©/ëŒ€ì¶œê¸°ë¡
| ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ | DBíŠ¸ë¦¬ê±° ì‘ì„±


<details><summary><b>application.properties</b></summary>

<pre>spring.application.name=Metro_House_Pjt
server.port=8485

#Spring MVC
spring.mvc.view.prefix=/WEB-INF/views/
spring.mvc.view.suffix=.jsp

#Database config
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver
spring.datasource.url=jdbc:oracle:thin:@localhost:1521:xe
spring.datasource.username=bookmanager
spring.datasource.password=1234

#mybatis config
mybatis.config-location=classpath:mybatis-config.xml

#kakao.api.key=${KAKAO_API_KEY}
kakao.api.key=ì¹´ì¹´ì˜¤ api ë“±ë¡í•´ì£¼ì„¸ìš”.

#naver email
smtp_id=ë„¤ì´ë²„ ì•„ì´ë”” ë“±ë¡í•´ì£¼ì„¸ìš”.
smtp_pw=ë„¤ì´ë²„ ë¹„ë°€ë²ˆí˜¸ ë“±ë¡í•´ì£¼ì„¸ìš”.
  
# gemini api
apiKey =

</pre></details>



## ERD
![ì œëª© ì—†ìŒ](https://github.com/user-attachments/assets/6fcc184a-7832-47de-9f53-7db4e7636054)


<details>
  <summary>ì¿¼ë¦¬ë¬¸ (íŠ¸ë¦¬ê±° ê°œë³„ ì‹¤í–‰)</summary>
  <pre><code>
GRANT CREATE SESSION, CREATE TABLE, CREATE VIEW, CREATE SEQUENCE, 
      CREATE SYNONYM, CREATE PROCEDURE, CREATE TRIGGER, CREATE MATERIALIZED VIEW 
TO bookmanager;
GRANT SELECT ANY TABLE, INSERT ANY TABLE, UPDATE ANY TABLE, DELETE ANY TABLE
TO bookmanager;
ALTER USER bookmanager DEFAULT TABLESPACE USERS;
ALTER USER bookmanager QUOTA UNLIMITED ON USERS;


CREATE TABLE USERINFO (
userNumber      NUMBER PRIMARY KEY,
userId          VARCHAR2(100),
userPw          VARCHAR2(100),
userName        VARCHAR2(100),
userTel         VARCHAR2(20),
userEmail       VARCHAR2(200),
userBirth       VARCHAR2(50),
userZipCode     VARCHAR2(50),
userAddress     VARCHAR2(300),
userDetailAddress VARCHAR2(500),
userBorrow      NUMBER DEFAULT 0,
userCanBorrow      NUMBER DEFAULT 5,
userAdmin       NUMBER DEFAULT 0,
userRegdate     DATE DEFAULT SYSDATE
);


CREATE TABLE user_sessions (
userId VARCHAR(50) PRIMARY KEY,
sessionId VARCHAR(100) NOT NULL,
loginTime TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE BOOKINFO (
bookNumber          NUMBER PRIMARY KEY,
bookIsbn            VARCHAR2(50) DEFAULT 0,
bookTitle           VARCHAR2(400),
bookComent          VARCHAR2(4000),
bookWrite           VARCHAR2(100),
bookPub             VARCHAR2(100),
bookDate            DATE,
bookMajorCategory   NVARCHAR2(100),
bookSubCategory     NVARCHAR2(100),
bookCount           NUMBER,
bookBorrowCount     NUMBER DEFAULT 0
);


CREATE TABLE NOTICE(
noticeNum            NUMBER PRIMARY KEY,
noticeTitle          VARCHAR2(500) NOT NULL,
noticeContent        VARCHAR2(4000) NOT NULL,
noticewriter         VARCHAR2(100) DEFAULT 'ê´€ë¦¬ì',
noticeregdate        DATE DEFAULT SYSDATE,
noticeviews          NUMBER DEFAULT 0,
noticeCategory       VARCHAR2(30)
);


CREATE TABLE BOARD (
boardNumber     NUMBER PRIMARY KEY,
userNumber      NUMBER,
userName        VARCHAR2(50),
boardTitle      VARCHAR2(1000),
boardContent    VARCHAR2(4000),
boardWriteDate  DATE DEFAULT SYSDATE,
boardHit        NUMBER DEFAULT 0,
boardViews      NUMBER DEFAULT 0,
boardLikes      NUMBER DEFAULT 0,
FOREIGN KEY (userNumber) REFERENCES USERINFO(userNumber)ON DELETE CASCADE
);


CREATE TABLE board_likes (
boardNumber number,
userNumber number,
PRIMARY KEY (boardNumber, userNumber)
);


CREATE TABLE BOARD_COMMENT (
commentNumber       NUMBER PRIMARY KEY,
commentSubNumber    NUMBER,
commentSubStepNumber NUMBER,
boardNumber         NUMBER,
userNumber          NUMBER,
userName            VARCHAR2(50),
commentContent      VARCHAR2(4000),
commentWriteDate    DATE DEFAULT SYSDATE,
COMMENTSTATUS VARCHAR2(10) DEFAULT 'ACTIVE'
);


ALTER TABLE BOARD_COMMENT
ADD CONSTRAINT fk_comment_board
FOREIGN KEY (boardNumber)
REFERENCES BOARD(boardNumber)
ON DELETE CASCADE;


ALTER TABLE BOARD_COMMENT
ADD CONSTRAINT fk_comment_user
FOREIGN KEY (userNumber)
REFERENCES USERINFO(userNumber)
ON DELETE CASCADE;
DESC board_comment;


CREATE TABLE BOOK_BORROW (
borrowNumber        NUMBER PRIMARY KEY,
userNumber          NUMBER,
bookNumber          NUMBER,
bookTitle           VARCHAR2 (400),
bookWrite           VARCHAR2 (100),
bookBorrowDate      DATE DEFAULT SYSDATE,
bookReturnDate      DATE,
bookMajorCategory   NVARCHAR2(100),
bookSubCategory     NVARCHAR2(100),
FOREIGN KEY (userNumber) REFERENCES USERINFO(userNumber)ON DELETE CASCADE,
FOREIGN KEY (bookNumber) REFERENCES BOOKINFO(bookNumber)ON DELETE CASCADE
);
CREATE TABLE Book_RECORD (
recordNumber  NUMBER PRIMARY KEY,
userNumber          NUMBER,
bookNumber          NUMBER,
bookTitle           VARCHAR2 (400),
bookWrite           VARCHAR2 (100),
bookBorrowDate      DATE,
bookReturnDate      DATE,
bookMajorCategory   NVARCHAR2(100),
bookSubCategory     NVARCHAR2(100),
FOREIGN KEY (userNumber) REFERENCES USERINFO(userNumber),
FOREIGN KEY (bookNumber) REFERENCES BOOKINFO(bookNumber)
);


CREATE TABLE BOOK_REVIEW (
REVIEWID NUMBER PRIMARY KEY,                -- ë¦¬ë·° ê³ ìœ  ID (ì‹œí€€ìŠ¤ ì‚¬ìš©)
BOOKNUMBER NUMBER NOT NULL,                 -- ë„ì„œ ë²ˆí˜¸ (ì™¸ë˜í‚¤) - ì‹¤ì œ íƒ€ì…ìœ¼ë¡œ ìˆ˜ì • í•„ìš”
USERNUMBER NUMBER NOT NULL,                 -- ì‚¬ìš©ì ID (ì™¸ë˜í‚¤) - VARCHAR2(50)ì—ì„œ NUMBERë¡œ ìˆ˜ì •
REVIEWTITLE VARCHAR2(200) NOT NULL,         -- ë¦¬ë·° ì œëª©
REVIEWCONTENT CLOB NOT NULL,                -- ë¦¬ë·° ë‚´ìš© (ê¸´ í…ìŠ¤íŠ¸)
REVIEWRATING NUMBER(1) NOT NULL,            -- í‰ì  (1-5)
REVIEWDATE DATE DEFAULT SYSDATE,            -- ì‘ì„±ì¼
REVIEWMODIFIED_DATE DATE,                   -- ìˆ˜ì •ì¼
REVIEWSTATUS VARCHAR2(10) DEFAULT 'ACTIVE',           -- ìƒíƒœ (Y: í™œì„±, N: ì‚­ì œ)


CONSTRAINT FK_REVIEW_BOOK FOREIGN KEY (BOOKNUMBER) REFERENCES BOOKINFO(BOOKNUMBER),
CONSTRAINT FK_REVIEW_USER FOREIGN KEY (USERNUMBER) REFERENCES USERINFO(USERNUMBER),
CONSTRAINT CHK_REVIEW_RATING CHECK (REVIEWRATING BETWEEN 1 AND 5)

    

  

);
-- ë¦¬ë·° ID ì‹œí€€ìŠ¤
CREATE SEQUENCE SEQ_REVIEW_ID
START WITH 1
INCREMENT BY 1
NOCACHE;


CREATE TABLE REVIEW_HELPFUL (
HELPFUL_ID NUMBER PRIMARY KEY,
REVIEWID NUMBER NOT NULL,
USERNUMBER NUMBER NOT NULL,
HELPFUL_DATE DATE DEFAULT SYSDATE,
CONSTRAINT FK_REVIEW_HELPFUL_REVIEW FOREIGN KEY (REVIEWID) REFERENCES BOOK_REVIEW(REVIEWID),
CONSTRAINT FK_REVIEW_HELPFUL_USER FOREIGN KEY (USERNUMBER) REFERENCES USERINFO(USERNUMBER),
CONSTRAINT UQ_REVIEW_HELPFUL UNIQUE (REVIEWID, USERNUMBER)
);


-- ë¦¬ë·°(ë„ì›€ë¨)ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE SEQ_HELPFUL_ID
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;


-- ê±°ë˜ê²Œì‹œíŒ
CREATE TABLE Trade_Post (
    postID NUMBER PRIMARY KEY,
    userNumber NUMBER NOT NULL,  -- userIDì—ì„œ userNumberë¡œ ë³€ê²½
    title VARCHAR2(100) NOT NULL,
    content CLOB NOT NULL,
    price NUMBER NOT NULL,
    status VARCHAR2(20) DEFAULT 'AVAILABLE', -- AVAILABLE, RESERVED, SOLD
    location VARCHAR2(100),
    viewCount NUMBER DEFAULT 0,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    BOOKMAJORCATEGORY VARCHAR2(100),
    BOOKSUBCATEGORY VARCHAR2(100),
    CONSTRAINT fk_tradePost_user FOREIGN KEY (userNumber) REFERENCES userinfo(userNumber)  -- ì°¸ì¡° ì»¬ëŸ¼ ë³€ê²½
);

-- ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE seqPostID START WITH 1 INCREMENT BY 1;

-- ì±„íŒ…ë°©
CREATE TABLE Trade_ChatRoom (
    roomID NUMBER PRIMARY KEY,
    postID NUMBER NOT NULL,
    sellerNumber NUMBER NOT NULL,  -- sellerIDì—ì„œ sellerNumberë¡œ ë³€ê²½
    buyerNumber NUMBER NOT NULL,   -- buyerIDì—ì„œ buyerNumberë¡œ ë³€ê²½
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    lastMessageAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status VARCHAR2(20) DEFAULT 'ACTIVE', -- ACTIVE, INACTIVE, BLOCKED
    CONSTRAINT fk_chatRoom_post FOREIGN KEY (postID) REFERENCES TradePost(postID),
    CONSTRAINT fk_chatRoom_seller FOREIGN KEY (sellerNumber) REFERENCES userinfo(userNumber),  -- ì°¸ì¡° ì»¬ëŸ¼ ë³€ê²½
    CONSTRAINT fk_chatRoom_buyer FOREIGN KEY (buyerNumber) REFERENCES userinfo(userNumber),    -- ì°¸ì¡° ì»¬ëŸ¼ ë³€ê²½
    CONSTRAINT uq_chatRoom UNIQUE (postID, sellerNumber, buyerNumber)  -- ì œì•½ì¡°ê±´ ì»¬ëŸ¼ëª… ë³€ê²½
);

-- ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE seqRoomID START WITH 1 INCREMENT BY 1;

-- ì±„íŒ…ë°© ë©”ì„¸ì§€
CREATE TABLE Trade_ChatMessage (
    messageID NUMBER PRIMARY KEY,
    roomID NUMBER NOT NULL,
    senderNumber NUMBER NOT NULL,  -- senderIDì—ì„œ senderNumberë¡œ ë³€ê²½
    message CLOB NOT NULL,
    readStatus VARCHAR2(10) DEFAULT 'UNREAD', -- READ, UNREAD
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_chatMessage_room FOREIGN KEY (roomID) REFERENCES ChatRoom(roomID),
    CONSTRAINT fk_chatMessage_sender FOREIGN KEY (senderNumber) REFERENCES userinfo(userNumber)  -- ì°¸ì¡° ì»¬ëŸ¼ ë³€ê²½
);

-- ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE seqMessageID START WITH 1 INCREMENT BY 1;

-- ì¤‘ê³ ë„ì„œ ê´€ì‹¬
CREATE TABLE Trade_Favorite (
    favoriteID NUMBER PRIMARY KEY,
    postID NUMBER NOT NULL,
    userNumber NUMBER NOT NULL,  -- userIDì—ì„œ userNumberë¡œ ë³€ê²½
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_tradeFavorite_post FOREIGN KEY (postID) REFERENCES TradePost(postID),
    CONSTRAINT fk_tradeFavorite_user FOREIGN KEY (userNumber) REFERENCES userinfo(userNumber),  -- ì°¸ì¡° ì»¬ëŸ¼ ë³€ê²½
    CONSTRAINT uq_tradeFavorite UNIQUE (postID, userNumber)  -- ì œì•½ì¡°ê±´ ì»¬ëŸ¼ëª… ë³€ê²½
);

-- ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE seqFavoriteID START WITH 1 INCREMENT BY 1;

-- ê±°ë˜ë‚´ì—­
CREATE TABLE Trade_record (
    transactionID NUMBER PRIMARY KEY,
    postID NUMBER NOT NULL,
    sellerNumber NUMBER NOT NULL,  -- sellerIDì—ì„œ sellerNumberë¡œ ë³€ê²½
    buyerNumber NUMBER NOT NULL,   -- buyerIDì—ì„œ buyerNumberë¡œ ë³€ê²½
    price NUMBER NOT NULL,
    status VARCHAR2(20) DEFAULT 'PENDING', -- PENDING, COMPLETED, CANCELED
    completedAt TIMESTAMP,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_transaction_post FOREIGN KEY (postID) REFERENCES TradePost(postID),
    CONSTRAINT fk_transaction_seller FOREIGN KEY (sellerNumber) REFERENCES userinfo(userNumber),  -- ì°¸ì¡° ì»¬ëŸ¼ ë³€ê²½
    CONSTRAINT fk_transaction_buyer FOREIGN KEY (buyerNumber) REFERENCES userinfo(userNumber)     -- ì°¸ì¡° ì»¬ëŸ¼ ë³€ê²½
);

-- ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE seqTransactionID START WITH 1 INCREMENT BY 1;

-- ê±°ë˜ í›„ê¸°
CREATE TABLE Trade_Review (
    reviewID NUMBER PRIMARY KEY,z
    transactionID NUMBER NOT NULL,
    reviewerNumber NUMBER NOT NULL,  -- reviewerIDì—ì„œ reviewerNumberë¡œ ë³€ê²½
    revieweeNumber NUMBER NOT NULL,  -- revieweeIDì—ì„œ revieweeNumberë¡œ ë³€ê²½
    rating NUMBER(2,1) NOT NULL,
    content VARCHAR2(500),
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_review_transaction FOREIGN KEY (transactionID) REFERENCES TradeTransaction(transactionID),
    CONSTRAINT fk_review_reviewer FOREIGN KEY (reviewerNumber) REFERENCES userinfo(userNumber),  -- ì°¸ì¡° ì»¬ëŸ¼ ë³€ê²½
    CONSTRAINT fk_review_reviewee FOREIGN KEY (revieweeNumber) REFERENCES userinfo(userNumber),  -- ì°¸ì¡° ì»¬ëŸ¼ ë³€ê²½
    CONSTRAINT uq_tradeReview UNIQUE (transactionID, reviewerNumber)  -- ì œì•½ì¡°ê±´ ì»¬ëŸ¼ëª… ë³€ê²½
);

-- ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE seqReviewID START WITH 1 INCREMENT BY 1;



--------------------------------------------- ì‹œí€€ìŠ¤ ë“œë˜ê·¸ë¡œ ê°œë³„ ì»´íŒŒì¼
CREATE SEQUENCE  "BOOKMANAGER"."BORROWRECORD_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE  NOORDER  NOCYCLE


--------------------------------------------- íŠ¸ë¦¬ê±° ë“œë˜ê·¸ë¡œ ê°œë³„ ì»´íŒŒì¼
create or replace TRIGGER after_book_record_insert
after INSERT ON book_record
FOR EACH ROW

BEGIN
-- BOOKINFO ì—…ë°ì´íŠ¸
UPDATE BOOKINFO
SET
BOOKCOUNT = BOOKCOUNT + 1
WHERE BOOKNUMBER = :NEW.BOOKNUMBER;

-- USERINFO ì—…ë°ì´íŠ¸
UPDATE USERINFO
SET
    USERCANBORROW = USERCANBORROW + 1
WHERE USERNUMBER = :NEW.USERNUMBER;

END;
--------------------------------------------- íŠ¸ë¦¬ê±° ë“œë˜ê·¸ë¡œ ê°œë³„ ì»´íŒŒì¼
create or replace TRIGGER before_book_record_insert
BEFORE INSERT ON book_record
FOR EACH ROW
DECLARE
v_borrowDate DATE;
v_borrowNumber NUMBER;
v_booktitle varchar2(400);
v_bookwrite varchar2(100);
v_bookmajor varchar2(100);
v_booksub   varchar2(100);
v_recordNumber number;
v_returnDate date default SYSDATE;
ex_no_borrow EXCEPTION;
BEGIN
-- í•´ë‹¹ ëŒ€ì¶œ ì •ë³´ ìœ ë¬´ í™•ì¸
SELECT borrowNumber, bookBorrowDate
INTO v_borrowNumber, v_borrowDate
FROM book_borrow
WHERE bookNumber = :NEW.bookNumber
AND userNumber = :NEW.userNumber;

select booktitle, bookwrite, bookmajorcategory, booksubcategory
into v_booktitle, v_bookwrite, v_bookmajor, v_booksub
from bookinfo
where bookNumber = :NEW.bookNumber;

 -- ìƒˆë¡œìš´ borrowRecordNumber ë¯¸ë¦¬ ìƒì„±
SELECT NVL(MAX(recordNumber), 0) + 1
INTO v_recordNumber
FROM book_record;

:NEW.bookBorrowDate := v_borrowDate;
:NEW.bookReturnDate := v_returnDate;
:NEW.booktitle := v_booktitle;
:NEW.bookwrite := v_bookwrite;
:new.bookmajorcategory := v_bookmajor;
:new.booksubcategory := v_booksub;

-- ê·¸ ë‹¤ìŒ BOOK_BORROWì—ì„œ ì‚­ì œ
DELETE FROM book_borrow
WHERE bookNumber = :NEW.bookNumber
  AND userNumber = :NEW.userNumber;
  
EXCEPTION
WHEN NO_DATA_FOUND THEN
RAISE_APPLICATION_ERROR(-20004, 'ëŒ€ì¶œ ì •ë³´ê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ ë°˜ë‚©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
END;
--------------------------------------------- íŠ¸ë¦¬ê±° ë“œë˜ê·¸ë¡œ ê°œë³„ ì»´íŒŒì¼
create or replace TRIGGER trg_after_book_borrow_insert
-- AFTER ì—ì„œ BEFOREë¡œ ë°”ë€œ
-- ì¤‘ë³µ ëŒ€ì¶œ ì²´í¬(ì¡°íšŒ)ë¥¼ ìœ„í•´ beforeë¡œ ìˆ˜ì •
BEFORE INSERT ON BOOK_BORROW
FOR EACH ROW
DECLARE
v_bookcount     NUMBER;
v_usercanborrow NUMBER;
v_count    NUMBER;
v_booktitle     varchar2(400);
v_bookwrite     varchar2(100);
v_bookmajor     varchar2(100);
v_booksub       varchar2(100);
ex_no_stock     EXCEPTION;
ex_no_quota     EXCEPTION;
ex_already_borrowed EXCEPTION;
BEGIN
-- ì±… ì¬ê³ , ì œëª©, ì €ì í™•ì¸
SELECT BOOKCOUNT, booktitle, bookwrite, bookmajorcategory, booksubcategory
INTO v_bookcount, v_booktitle, v_bookwrite, v_bookmajor, v_booksub
FROM BOOKINFO
WHERE BOOKNUMBER = :NEW.BOOKNUMBER;

:NEW.booktitle := v_booktitle;
:NEW.bookwrite := v_bookwrite;
:NEW.bookReturnDate := SYSDATE + 30;
:new.bookmajorcategory := v_bookmajor;
:new.booksubcategory := v_booksub;

-- ì‚¬ìš©ì ëŒ€ì¶œ ê°€ëŠ¥ íšŸìˆ˜ í™•ì¸
SELECT USERCANBORROW INTO v_usercanborrow
FROM USERINFO
WHERE USERNUMBER = :NEW.USERNUMBER;

-- ì¤‘ë³µ ëŒ€ì¶œ ì²´í¬
SELECT COUNT(*) INTO v_count
FROM BOOK_BORROW
WHERE USERNUMBER = :NEW.USERNUMBER
 AND BOOKNUMBER = :NEW.BOOKNUMBER;

IF v_count > 0 THEN
RAISE ex_already_borrowed;
END IF;

-- ì˜ˆì™¸ ì¡°ê±´ ê²€ì‚¬
IF v_bookcount <= 0 THEN
    RAISE ex_no_stock;
ELSIF v_usercanborrow <= 0 THEN
    RAISE ex_no_quota;
END IF;

-- BOOKINFO ì—…ë°ì´íŠ¸
UPDATE BOOKINFO
SET
    BOOKBORROWCOUNT = BOOKBORROWCOUNT + 1,
    BOOKCOUNT = BOOKCOUNT - 1
WHERE BOOKNUMBER = :NEW.BOOKNUMBER;

-- USERINFO ì—…ë°ì´íŠ¸
UPDATE USERINFO
SET
    USERCANBORROW = USERCANBORROW - 1,
    USERBORROW = USERBORROW + 1
WHERE USERNUMBER = :NEW.USERNUMBER;

EXCEPTION
WHEN ex_no_stock THEN
RAISE_APPLICATION_ERROR(-20001, 'ë„ì„œ ì¬ê³ ê°€ ë¶€ì¡±í•˜ì—¬ ëŒ€ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
WHEN ex_no_quota THEN
RAISE_APPLICATION_ERROR(-20002, 'íšŒì›ì˜ ëŒ€ì¶œ ê°€ëŠ¥ ê¶Œìˆ˜ê°€ 0ì…ë‹ˆë‹¤.');
WHEN ex_already_borrowed THEN
RAISE_APPLICATION_ERROR(-20004, 'ì´ë¯¸ ë¹Œë¦° ì±… ì…ë‹ˆë‹¤');
WHEN OTHERS THEN
RAISE_APPLICATION_ERROR(-20003, 'íŠ¸ë¦¬ê±° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' || SQLERRM);
END;
  </code></pre>
</details>

## ğŸ”‘íšŒì›ê°€ì… - ë„ë¡œëª… api
https://github.com/user-attachments/assets/1e1b3202-5e98-482b-ba6a-8f2281aadce5

## ğŸ ë§ˆì´í˜ì´ì§€ - ëŒ€ì¶œì¤‘ë„ì„œ, ì—°ì²´ë„ì„œ, ì´ ëŒ€ì¶œ ì´ë ¥, ëŒ€ì¶œí˜„í™©&ê¸°ë¡
https://github.com/user-attachments/assets/21322cc8-3d86-4957-b91a-c8b608871d74

## ğŸ“–ëŒ€ì¶œ&ë°˜ë‚©
https://github.com/user-attachments/assets/9cf238c0-6ded-475b-a1fd-eb9e090d7dd1

## ğŸ“¨ê²Œì‹œíŒ ì‘ì„±, ìˆ˜ì •, ì‚­ì œ, ëŒ“ê¸€, ì¶”ì²œ
https://github.com/user-attachments/assets/295d5c3a-c79f-47a0-b290-f535c7cfbd1d

## ğŸ“• ë„ì„œ ë“±ë¡
https://github.com/user-attachments/assets/c25e002f-0a1c-4fdb-8285-8b6f5f99a085

## âœï¸ë„ì„œ ìˆ˜ì •
https://github.com/user-attachments/assets/6a497dd5-5aa5-4dac-9bef-000b31cdd8e0

## ğŸ“¢ê³µì§€ì‚¬í•­ ì‘ì„±, ìˆ˜ì •, ì‚­ì œ
https://github.com/user-attachments/assets/5691abc0-2bc7-49a5-9be8-166daf432095
